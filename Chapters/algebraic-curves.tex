%!TEX root = ../main.tex
\chapter{Algebraic curves}\label{ch:algebraic-curves}
In the preceding chapter we presented the ``residue map'' in an abstract context. In this chapter, we explore residues on algebraic curves using Tate's construction. First, we recall briefly and with little detail the basic theory of algebraic projective curves. For a complete exposition we reference the reader to \cite{curves} and \cite{hartshorne}. We will borrow many results from commutative algebra, most of them can be found in \cite{Matsumura}, \cite{comm-alg} and \cite{atiyah}.
\section{Basic theory of algebraic curves}
Let $k$ be an algebraically closed field. Let $(X, \O_{X})$ be a projective algebraic variety. Then 
\[
	k(X) := \varinjlim_{U\subseteq X} \O_{X}(U)
\]
 is the \textbf{function field} or \textbf{field of rational functions} of $X$. In addition, consider the stalk 
\[
	\O_{X,p} := \varinjlim_{p\in U\subseteq X} \O_{X}(U)
\]
of regular functions near $p$. We obtain natural injections 
\[
 	\O_{X}(X) \to \O_{X,p} \to k(X).
\] 
\begin{proposition}\label{prop:fraction-field-local-function-field}
	The fraction field of $\O_{X,p}$ is $k(X)$.
\end{proposition}
\begin{proof}
	Let $U \subseteq X$ be an affine neighborhood of $p$. Suppose that $A$ is the coordinate ring of $X$ on $U$ and let $\mathfrak{p}$ be the maximal ideal of $A$ corresponding to $p$. Therefore, $A_{\mathfrak{p}} = \O_{X,p}$. Since $U$ is affine $\O_{X}(U) = A$ and $k(U) = \Frac{A}$. Moreover, irreducibility of $X$ implies $k(X) = k(U)$. Hence, 
	\[
		k(X) = k(U) = \Frac{A} = \Frac{A_{\mathfrak{p}}} = \Frac{\O_{X,p}}.
	\]
\end{proof}

Moreover, $\O_{X,p}$ is a noetherian local ring of Krull dimension $\dim X$.
Its maximal ideal of regular functions near $p$ that vanish in $p$ is denoted $\mathfrak{m}_{p}$. Observe that evaluation at $p$ yields the isomorphism $\O_{X,p}/\mathfrak{m}_{p} \cong k$.

\subsection*{Smoothness and completeness}
\begin{definition}\label{def:regular-local-ring}
	A local ring $(A, \mathfrak{m})$, where $\mathfrak{m}$ denotes its maximal ideal, is called \textbf{regular} if $\dim_{A/\mathfrak{m}} \mathfrak{m}/\mathfrak{m}^{2} = \dim A$. 
\end{definition}
Let $(A,\mathfrak{m})$ be a noetherian regular local ring. Let $k = A/\mathfrak{m}$ be its residue field. In this situation, $(A,\mathfrak{m})$ carries a natural topology, called the $\mathfrak{m}$-adic topology. Namely, $\{\mathfrak{m}^{n}\}_{n\geq 1}$ is a system of neighborhoods around zero and we let the topology to be translation invariant. We already mentioned this topology briefly in \cref{ex:tate-spaces} for the polynomial ring. The $\mathfrak{m}$-adic topology is separated. Indeed, 
\[
	\bigcap_{n\geq 1} \mathfrak{m}^{n} = \{0\}
\]
by Krull intersection theorem. See Theorem (18.29) in \cite{comm-alg}. Just as in \cref{def:completion} we define the \textbf{completion} $\widehat{A}$ of $A$ to be 
\[
	\widehat{A} := \varprojlim_{n\geq 1} A/\mathfrak{m}^{n}.
\]
There is a natural map $A \to \widehat{A}$. In particular, since $A$ is separated this map is injective. When this map is an isomorphism we say that $A$ is \textbf{complete}. We summarize several properties of completion in the following theorem:
\begin{theorem}\label{thm:properties-adic-completion}
	Let $(A,\mathfrak{m})$ be a noetherian regular local ring. Then
	\begin{enumerate}[label = (\alph*)]
		\item $\widehat{A}$ is a noetherian regular local ring and $\widehat{\mathfrak{m}}$ is its maximal ideal.
		\item Krull dimension is preserved under completion, that is, $\dim A = \dim \widehat{A}$.
		\item (Cohen structure theorem) If $\dim A = n$, then
		\[
			\widehat{A} \cong k\left[[t_{1}, \ldots, t_{n}]\right].
		\]
		Where $t_{1}, \ldots t_{n}$ are mapped to generators of $\mathfrak{m}$.
	\end{enumerate}
	\begin{proof}
	See Chapter 22 in \cite{comm-alg}.  
	\end{proof}
	
\end{theorem}
Now, we explore these results in the geometrical setting. 
\begin{definition}\label{def:}
	If $\O_{X,p}$ is a regular local ring, that is, $\dim_{k} \mathfrak{m}_{p}/\mathfrak{m}_{p}^{2} = \dim \O_{X,p} = \dim X$, we say that $X$ is \textbf{smooth at} $p$. Naturally, $X$ is called \textbf{smooth} if it is smooth at every point $p\in X$.
\end{definition}
We get the following result immediately from \cref{thm:properties-adic-completion}.
\begin{corollary}\label{cor:smooth-iff-isomorphic-to-power-series}
	If $X$ is smooth then $\widehat{\O_{X,p}} \cong k[[t_{1}, t_{2}, \ldots, t_{n}]]$ where $n = \dim X$.
\end{corollary}
Now, we focus in one-dimensional varieties.
\begin{definition}\label{def:algebraic-curve}
	An \textbf{algebraic curve} is a one-dimensional smooth projective variety.
\end{definition}
In dimension $1$ smoothness can be interpreted in the language of valuations.
\subsection*{Valuation theory}
Let $k$ be a field. 
\begin{definition}\label{def:discrete-valuation}
	A \textbf{discrete valuation} is a surjective group homomorphism $\nu\colon k^{\times} \to \Z$ such that, for every $x\in k^{\times}$ and $y \neq -x$ in $k^{\times}$
	\[
		\nu(x + y) \geq \min\{\nu(x), \nu(y)\}.
	\]
	As a convention, we let $\nu(0) = \infty$. We denote by
	\[
	A_{\nu} = \{x \in k\colon \nu(x)\geq 0\}
	\]
	the \textbf{discrete valuation ring} or \textbf{DVR} of $\nu$. Clearly, $A$ is a subring, thus a domain. Consider
	\[
		\mathfrak{m}_{\nu} = \{x\in k\colon \nu(x) > 0\}. 
	\]
	Notice that, if $x\in k$, but $x\notin A_{\nu}$, then $x^{-1}\in \mathfrak{m}_{\nu}$. Hence, $\operatorname{Frac}(A_{\nu}) = K$. Further, observe that
	\[
	A_{\nu}^{\times} = A_{\nu} - \mathfrak{m}_{\nu}.
	\]
	Therefore, $A_{\nu}$ is a local domain with maximal ideal $\mathfrak{m}_{\nu}$. An element $t \in \mathfrak{m}_{\nu}$ with $\nu(t) = 1$ is called a \textbf{uniformizing parameter}. Such $t$ is irreducible, because if $t = ab$ with $\nu(a)\geq 0$ and $\nu(b)\geq 0$ implies $\nu(a) = 0$ or $\nu(b) = 0$ since $1 = \nu(a) + \nu(b)$. Further, any $x \in k^{\times}$ has the unique factorization $x = u t^{n}$ where $u \in A_{\nu}^{\times}$ and $n := \nu(x)$. Moreover, $A_{\nu}$ is a principal ideal domain. In fact, any nonzero ideal $\mathfrak{a} \subseteq A_{\nu}$ has the form
	\[
		\mathfrak{a} = \left\langle t^{m}\right\rangle \quad\text{where}\quad m:=\min\{\nu(x)\colon x\in \mathfrak{a}\}.
	\]
	Indeed, given a nonzero $x \in \mathfrak{a}$, say $x = ut^{n}$ where $u \in A_{\nu}^{\times}$. Then $t^{n}\in \mathfrak{a}$. Son $n \geq m$. Set $y := ut^{n-m}$. Then $y\in A_\nu$ and $x = yt^{m}$, as desired. Finally, $\mathfrak{m} = \langle t\rangle$ and $\dim A_{\nu} = 1$. Therefore, $A$ is regular local of dimension one.
\end{definition}
We have the following characterization theorem for DVRs.
\begin{theorem}\label{thm:characterization-of-DVRs}
	Let $A$ be a noetherian one-dimensional local ring, $\mathfrak{m}$ its maximal ideal and $k = A/\mathfrak{m}$ its residue field. Then these conditions are equivalent:
	\begin{enumerate}[label = (\roman*)]
		\item $A$ is a DVR.
		\item $A$ is integrally closed.
		\item $\mathfrak{m}$ is principal.
		\item $\dim_{k}(\mathfrak{m}/\mathfrak{m}^{2}) = 1$.
		\item Every non-zero ideal is a power of $\mathfrak{m}$.
	\end{enumerate}
\end{theorem}
\begin{proof}
	See Proposition 9.2 in \cite{atiyah}.
\end{proof}
\begin{corollary}\label{cor:smoothness-DVR-curves}
	Let $X$ be a one-dimensional projective variety. Then, $X$ is smooth if and only if $\O_{X,p}$ is a DVR for all $p$.
\end{corollary}
\begin{example}\label{ex:stalk-of-regular-functions-as-a-DVR}
	Let $(X,\O_{X})$ be an algebraic curve. Let $p \in X$ and consider $\O_{X,p}$. In this case $\O_{X,p}$ is a DVR. Let $t_{p}\in \O_{X,p}$ be an uniformizing parameter. Then, if $f \in k(X)$ it follows that $f = ut_{p}^{n}$ for some  unit $u\in \O_{X,p}$ and $n \in \Z$. Then, $\nu_{p}(f) = n$.
\end{example}
\section{Tate spaces over algebraic curves}
Let $(X,\O_{X})$ be an algebraic curve over an algebraically closed field $k$. Let $K := k(X)$. For all $p \in X$ we use the following notation $L_{p} := \widehat{\O_{X,p}}$ and $K_{p}:=\Frac L_{p}$. From \cref{thm:properties-adic-completion} and $\cref{thm:characterization-of-DVRs}$ it follows that $L_{p}$ is a DVR. Let $t_{p}$ be an uniformizing parameter in $L_{p}$. The topology in $K_{p}$ defined by letting $\{t_{p}^{n}L_{p}\}_{n\in \Z}$ be a system of neighborhoods of zero in $K_{p}$. This system is compatible with the valuation induced by $L_{p}$.
\begin{proposition}\label{prop:complete-fraction-field-is-a-Tate-space}
	$K_{p}$ is a Tate space and $L_{p}$ is a c-lattice in $K_{p}$.
\end{proposition}
\begin{proof}
	Observe that the map $t_{p}^{n}L_{p}/t_{p}^{n+1}L_{p} \to L_{p}/t_{p}L_{p}$ induced by $ft^{n}\mapsto f$ is an isomorphism. Then, the exactness of
	\[
		0 \to t_{p}^{n}L_{p}/t_{p}^{n+1}L_{p} \to L_{p}/t_{p}^{n+1}L_{p} \to L_{p}/t_{p}^{n}L_{p} \to 0
	\]
	implies that every quotient $L_{p}/t_{p}^{n}L_{p}$ is finite-dimensional over $k$. Therefore, 
	\[
		L_{p} = \varprojlim_{n\geq 1} L_{p}/t_{p}^{n}L_{p}
	\]
	is complete and linearly compact. Since $L_{p}$ is open in $K_{p}$ then it is a c-lattice and $K_{p}$ is a Tate space.
\end{proof}
\begin{remark}\label{rem:mutually-commensurable-system}
\begin{enumerate}[label = (\alph*)]
	\item Observe that $\{t_{p}^{n}L_{p}\}_{n\in \Z}$ is a mutually commensurable system of neighborhoods around zero of consisting of $k$-vector subspaces of $K_{p}$. 
	\item Notice that multiplication by $f$ in $K_{p}$ is continuous in $K_{p}$, that is, $K_{p}$ (and particularly $K$) acts continuously over itself.
\end{enumerate}
\begin{definition}\label{def:residue-at-p}
	Let $f,g \in K_{p}$. We define the residue of the differential $fdg$ at $p\in X$ to be
	\[
		\res_{p}(fdg) = \res_{K_{p}}(fdg).
	\]
	where $\res_{K_{p}}$ denotes the abstract residue defined in \cref{thm:existence-of-residue}.
\end{definition}

\end{remark}
Let $f\in K_{p}$, observe that $fL_{p} = t_{p}^{n}L_{p}$ for some $n \in \Z$ and uniformizing parameter $t_{p} \in L_{p}$. 
\begin{proposition}\label{prop:no-poles-zero-residue}
	Let $p\in X$. If $\omega \in \Omega_{K_{p}/k}$ has no poles at $p$ then $\res_{p}(\omega) = 0$.
\end{proposition}
\begin{proof}
	Clear from \cref{prop:residue-and-continuity}.
\end{proof}

\begin{theorem}\label{thm:resiude-coincides-with-coefficient}
	Let $f,g \in K_{p}$. By the structure theorem in \cref{thm:properties-adic-completion} it follows that $f = \sum_{\nu \gg -\infty}^{\infty} a_{\nu}t_{p}^{\nu}$ and $g = \sum_{\mu \gg -\infty}^{\infty} b_{\mu}t_{p}^{\mu}$ for some $a_{\nu},b_{\mu} \in k$ and a uniformizing parameter $t_{p}\in L_{p} $. Recall that the formal derivative of $g$ is
	\[
		g' = \sum_{\mu \gg -\infty}^{\infty} \mu b_{\mu}t_{p}^{\mu -1}.
	\]
	Then,
	\[
		\res_{p}(fdg) = \text{coefficient of }t_{p}^{-1}\text{ in } fg'
	\]
	which is given by the Cauchy product
	\[
		\res_{p}(fdg) = \sum_{\mu + \nu = 0}\mu a_\nu{}b_{\mu}.
	\]
\end{theorem}
\begin{proof}
	Let
	\[
		\tilde{f} = \sum_{\nu\gg-\infty}^{N} a_{\nu}t_{p}^{\nu},\quad\text{and}\quad\tilde{g} = \sum_{\mu\gg-\infty}^{N} b_{\mu}t_{p}^{\mu}
	\]
	then 
	\begin{align*}
		\res_{p}(fdg) &= \res_{p}( (\tilde{f} + (f - \tilde{f}))d(\tilde{g} + (g - \tilde{g}))) \\
		&= \res_{p}(\tilde{f}d\tilde{g}) + \res_{p}(\tilde{f}d(g - \tilde{g})) + \res_{p}((f-\tilde{f}) d\tilde{g}) \\ &+ \res_{p}( (f - \tilde{f})d(g-\tilde{g})).
	\end{align*}
	If $N$ is sufficiently large, then by \cref{prop:residue-and-continuity} it follows that 
	\[
		\res_{p}( (f - \tilde{f})d(g-\tilde{g})) = \res_{p}(\tilde{f}d(g - \tilde{g})) = \res_{p}((f-\tilde{f}) d\tilde{g}) = 0.
	\]
	Therefore, we can assume that only finitely many of the $a_{\nu}$ and $b_{\mu}$ are non-zero. Now, $fdg = f g' dt$ and by \cref{prop:residue-of-a-power} only the term of $t_{p}^{-1}$ can have non-zero residue. Then, by \cref{prop:residue-of-invertible-element}, it follows that
	\[
		\res_{p}(t_{p}^{-1}dt_{p}) = \dim_{k}(L_{p}/t_{p}L_{p}) = \dim_{k}k = 1. 	
	\]
	Hence, $k$-linearity of residue implies the desired conclusion.
\end{proof}
\begin{corollary}\label{cor:invriance-of-residue-coefficient}
	Let $f\in K_{p}$. Then, the coefficient of $t_{p}^{-1}$ in the Laurent series expansion of $f$ is independent of the choice of uniformizing parameter $t_{p}$.	
\end{corollary}
\begin{remark}\label{rem:previouses-approaches-residues}
	Before Tate introduced this approach to residues of differentials on algebraic curves, residues were defined by the formula in \cref{thm:resiude-coincides-with-coefficient}. However, to prove well-definition of such formula, it is necessary to argue that the coefficient of $t_{p}^{-1}$ is independent of the choice of uniformizing parameter $t_{p}$. In $\operatorname{char}k = 0$ one can realize $X$ as an analytical variety and reduce it to the invariance of the formula
	\[
		\res_{p}(\omega) = \frac{1}{2\pi i}\oint_{p} \omega.
	\]
	Nevertheless, in the general setting it is not obvious why invariance follows. In \cref{cor:invriance-of-residue-coefficient} we gave a clean but taxing proof of such result. We reference the reader to \cite{serre} Chapter 2 Section 10 for a direct proof.
\end{remark}
\subsection*{Adèles and the residue theorem}
Our next goal is to prove the residue theorem.
\begin{theorem}\label{thm:residue-theorem}
	For $X$ an algebraic curve and $\omega \in \Omega_{K/k}$, then 
	\[
		\sum_{p\in X}\res_{p}(\omega) = 0.
	\]
\end{theorem}
First, observe that the expression $\sum_{p\in X}\res_{p}(\omega) = 0$ makes sense by \cref{prop:no-poles-zero-residue} and the fact that $\omega$ has a finite amount of poles.
